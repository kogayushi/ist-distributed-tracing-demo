<!-- $theme: gaia -->
<!-- $size: 16:9 -->
<!-- page_number: true -->
<!-- *page_number: false -->
<!-- *footer: -->
<!-- footer: What's distributed tracing -->
<!-- *footer -->

# What's Distributed Tracing

---
## アジェンダ
- 分散トレーシングについての説明
- サンプルアプリを用いてデモ

---
## つゆばらい
- 業務利用するにあたって調べたことを勉強会用に仕立て直したものを発表します
	- 一部はすでに業務に利用しているが実績としては不十分です
- なので、間違いや補足したほうが良いことを見つけた方は、
~~やさしく~~マサカリください 

---
## 分散トレーシング(Distributed Tracing)とは

- 簡単に言うとマイクロサービス間の通信を追跡可能にし、追跡結果を可視化する仕組みのことです

---
## なぜ、追跡する必要があるのか？

---
### まずマイクロサービスの目的から説明

しばらく前からそうですが、モノリスで作ったシステムをマイクロサービスに変換していく流れがあります。
この流れは以下の需要から生まれています

1. 他のサービスに影響を与えずにサービスを単独でデプロイしたい
2. デプロイ単位を依存関係のない他のサービスから分離かつ継続性あるものにしておきたい
3. 開発チームを小さくかつアジャイルに保ちたい

上記が満たせると、各チームに裁量を与えることもできます


---
### マイクロサービスのデメリットは？
以下のようなものが挙げられます（一部抜粋）
1. 分散システムのどこで`障害`がおきてるのかの調査が辛い
2. 分散システムのどこで`遅延`がおきてるのかの調査が辛い
3. 分散システム同士の`依存関係`がよくわからなくて辛い
4. 分散システム間で`データ整合性`を担保するのが辛い

---
### 新たに生じたデメリットはどうするの？
先程述べたうちの以下の3つに対しての手当が分散トレーシングです

👉 分散システムのどこで`障害`がおきてるのかの調査が辛い
👉 分散システムのどこで`遅延`がおきてるのかの調査が辛い
👉 分散システム同士の`依存関係`がよくわからなくて辛い

各マイクロサービス間の通信を`追跡`することで対処します。

---
### 追跡とは具体的に何を指すのか？
あるユーザの要求(≒操作)がサービスからサービスに`伝搬していく順番`やそれに`かかった時間`を`計測・特定可能`にすることを指します。

また、エラー時にはどのコンポーネントで`エラー`になったかも`特定可能`にします。

---
### 論より証拠
ということで、デモでそれがどういうことか示していきます

---

## Demo
### 登場人物
- マイクロサービスを想定した複数のアプリケーション
 	- Spring boot 2.0.x(Spring Cloud Sleuth with Brave)
- zipkin server
	- 追跡結果をここに集約し、可視化する

### sample application
- https://github.com/kogayushi/ist-distributed-tracing-demo


---
## 最後に
---

### OpenTracing vs Zipkin
- 分散トレーシングを実現する仕組み(とそれを作る団体)は2つあります
	- 他にもあるかもしれないけど検索するとこの2つがHITする
- どちらも同じことを達成してくれます（たぶん）
- Zipkinのほうが歴史が長いが故に成熟しており、バグが少ない（安定している）ようです
- 一方、OpenTracingの方が言語互換性は高くmemoryのfootprintも小さいようです

---

## Fin.